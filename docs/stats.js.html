<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>stats.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Clustering.html">Clustering</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Clustering.html#.getAreasPageRank">getAreasPageRank</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Clustering.html#.getDepValuesByYear">getDepValuesByYear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Clustering.html#.getMonths">getMonths</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Clustering.html#.getTotalByYear">getTotalByYear</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Info.html">Info</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Info.html#.getAgeRanges">getAgeRanges</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Info.html#.getMonthsValues">getMonthsValues</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Info.html#.getPageRank">getPageRank</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Info.html#.getTopAreas">getTopAreas</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Info.html#.getTopCountries">getTopCountries</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Info.html#.getTopRegions">getTopRegions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Info.html#.getTotByYear">getTotByYear</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="International.html">International</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="International.html#.getCountriesValuesByYear">getCountriesValuesByYear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="International.html#.getMonths">getMonths</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="International.html#.getTotalByYear">getTotalByYear</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="National.html">National</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="National.html#.getMonths">getMonths</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="National.html#.getRegionsPageRank">getRegionsPageRank</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="National.html#.getRegionsValuesByYear">getRegionsValuesByYear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="National.html#.getTotalByYear">getTotalByYear</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Stats.html">Stats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#.getDatabaseCountryStats">getDatabaseCountryStats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#.getDatabaseDepStats">getDatabaseDepStats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Stats.html#.getDatabaseStats">getDatabaseStats</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">stats.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Updater = require("../helpers/update");

/**
 * @namespace Stats
 */

/**
 * Finds number users that reviewed something until 2010
 * @function getDatabaseStats
 * @memberof Stats
 * 
 * @param {Object} sessions - Neo4j context session
 * 
 * @return {Object} Object with different statistics (number of users/reviews ...)
 */
exports.getDatabaseStats = (session) => {
  vYears = {};
  return session
    .run('MATCH (u:User)-[v:review]->() WHERE v.year >= 2010 RETURN v.year AS YEAR, count(*) as NB, count(distinct u.id) AS NBU')
    .then(function (result) {
      result.records.forEach(record => {
        y = record.get("YEAR").low;
        vYears[y] = {
          "year": y,
          "users": Updater.formatNumber(record.get("NBU")),
          "?": 0,
          "reviews": Updater.formatNumber(record.get("NB"))
        };
      });
      session.close();
      return vYears;
    })
    .catch(error => {
      console.log("Erreur : " + error);
      return null;
    })
}

/**
 * Finds users that reviews something for a given year and a specific country
 * @function getDatabaseCountryStats
 * @memberof Stats
 * 
 * @param {Object} sessions - Neo4j context session
 * @param {Object} params - Query's parameters
 * @param {Object[]} [vYears] - Found object array to concatenate different year stat 
 * 
 * @return {Object} Object with the year and number of users found
 */
exports.getDatabaseCountryStats = (session, params, vYears) => {
  var vYears = vYears || {};
  return session
    .run('MATCH (u:User)-[v:review]->() WHERE u.country = {COUNTRY} AND v.year >= 2010 RETURN v.year AS YEAR, count(distinct u.id) AS NB', params)
    .then(result =>{
      result.records.forEach(record=>{
        y = record.get("YEAR").low;
        !(y in vYears) &amp;&amp; (vYears[y]={})
        vYears[y][params.COUNTRY] = Updater.formatNumber(record.get("NB"));
      })
      session.close();
      return vYears;
    })
    .catch(error => {
      console.log("Erreur : " + error);
      throw {username: 'This field is required.', status: 400};
    })
}

/**
 * Finds users that reviews something for a given year and a specific department
 * @function getDatabaseDepStats
 * @memberof Stats
 * 
 * @param {Object} sessions - Neo4j context session
 * @param {Object} params - Query's parameters
 * @param {Object[]} [vYears] - Found object array to concatenate different year stat 
 * 
 * @return {Object} Object with the year and number of users found
 */
exports.getDatabaseDepStats = (session, params, vYears) => {
  var vYears = vYears || {};
  return session
    .run('MATCH ()-[v:review]->(l:Location{dep:{DEP}}) WHERE v.year >= 2010 RETURN v.year AS YEAR, count(*) AS NB', params)
    .then(result =>{
      result.records.forEach(record=>{
        y = record.get("YEAR").low;
        !(y in vYears) &amp;&amp; (vYears[y]={})
        vYears[y][params.DEP] = Updater.formatNumber(record.get("NB"));
      })
      session.close();
      return vYears;
    })
    .catch(error => {
      console.log("Erreur : " + error);
      return null;
    })
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon May 06 2019 14:48:17 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
